<% rate = JSON.parse(@film.rate) %>
<% sum = rate['star_5'] + rate['star_4'] + rate['star_3'] + rate['star_2']
      + rate['star_1'] %>
<% n = 5 %>
<% int_rate = @film.average_rate.floor %>
<% dec_rate = @film.average_rate - int_rate %>

<div class="rate-container">
  <b>User Rating</b>
  <div class="star">
    <p>
      <% int_rate.times do %>
          <%= image_tag 'star.png' %>
      <% end %>
      <% if dec_rate != 0 %>
          <% if dec_rate < 0.4 %>
              <%= image_tag 'one_quarter_star.png' %>
          <% elsif dec_rate < 0.7 %>
              <%= image_tag 'half_star.png' %>
          <% else %>
              <%= image_tag 'three_quarter_star.png' %>
          <% end %>
      <% end %>
    </p>
    <p><%= @film.average_rate %> average based on <%= sum %> reviews.</p>
  </div>
  <% rate.each do |key,value| %>
    <div class="bar-container">
        <b class="left"><%= n %> star</b><i class="right"><%= value %></i>
        <div class= 'bar-hundred'>
          <div class='bar-per bar-<%= n%>' style="width:<%= 100*value/sum %>%"></div>
        </div>
    </div>
  <% n-=1 %>
  <% end %>
</div>